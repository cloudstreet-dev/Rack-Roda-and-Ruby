<!DOCTYPE HTML>
<html lang="en" class="navy sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The Rack Spec (It Fits on a Napkin) - Rack, Roda, and Ruby</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Rails is just a callable. Sinatra is just a callable. So is Roda. This book strips away the magic of Ruby web development, shows you exactly what Rack is doing under the hood, and teaches you to build from first principles. Know your tools. Really know them.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "navy";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rack, Roda, and Ruby</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/cloudstreet-dev/Rack-Roda-and-Ruby" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/cloudstreet-dev/Rack-Roda-and-Ruby/edit/main/src/rack/the-spec.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="the-rack-spec-it-fits-on-a-napkin"><a class="header" href="#the-rack-spec-it-fits-on-a-napkin">The Rack Spec (It Fits on a Napkin)</a></h1>
<p>The Rack specification defines the interface between Ruby web servers and Ruby web applications. It was designed by Christian Neukirchen in 2007, and despite fifteen years of Ruby web development since then, it hasn't needed fundamental changes. Simple things tend to be durable.</p>
<p>Here's the spec:</p>
<blockquote>
<p>A Rack application is a Ruby object (not a class) that responds to <code>call</code>. It takes exactly one argument, the <em>environment</em>, and returns a non-frozen Array of exactly three values: the <em>status</em>, the <em>headers</em>, and the <em>body</em>.</p>
</blockquote>
<p>That's it. Three rules:</p>
<ol>
<li>Your app is an object (not a class — an instance)</li>
<li>It has a <code>call</code> method that takes an environment hash</li>
<li><code>call</code> returns <code>[status, headers, body]</code></li>
</ol>
<p>Everything else is elaboration.</p>
<h2 id="the-environment-hash"><a class="header" href="#the-environment-hash">The Environment Hash</a></h2>
<p>The environment (called <code>env</code> by convention) is a Ruby Hash containing information about the current request. The server populates it. Your application reads from it.</p>
<p>The Rack spec requires these keys:</p>
<div class="table-wrapper"><table><thead><tr><th>Key</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>REQUEST_METHOD</code></td><td>String</td><td><code>"GET"</code>, <code>"POST"</code>, <code>"PUT"</code>, etc.</td></tr>
<tr><td><code>SCRIPT_NAME</code></td><td>String</td><td>Mount point of the application (often <code>""</code>)</td></tr>
<tr><td><code>PATH_INFO</code></td><td>String</td><td>Path component of the URL, e.g. <code>"/users/42"</code></td></tr>
<tr><td><code>QUERY_STRING</code></td><td>String</td><td>Query string without <code>?</code>, e.g. <code>"page=2&amp;sort=name"</code></td></tr>
<tr><td><code>SERVER_NAME</code></td><td>String</td><td>Hostname, e.g. <code>"example.com"</code></td></tr>
<tr><td><code>SERVER_PORT</code></td><td>String</td><td>Port as a string, e.g. <code>"80"</code></td></tr>
<tr><td><code>HTTP_*</code></td><td>String</td><td>HTTP request headers, upcased with hyphens replaced by underscores</td></tr>
<tr><td><code>rack.version</code></td><td>Array</td><td>Rack version, e.g. <code>[1, 3]</code></td></tr>
<tr><td><code>rack.url_scheme</code></td><td>String</td><td><code>"http"</code> or <code>"https"</code></td></tr>
<tr><td><code>rack.input</code></td><td>IO-like</td><td>The request body, readable via <code>read</code>, <code>gets</code>, <code>each</code></td></tr>
<tr><td><code>rack.errors</code></td><td>IO-like</td><td>Error stream (usually <code>$stderr</code>)</td></tr>
<tr><td><code>rack.multithread</code></td><td>Boolean</td><td>Whether the server is multi-threaded</td></tr>
<tr><td><code>rack.multiprocess</code></td><td>Boolean</td><td>Whether the server is multi-process</td></tr>
<tr><td><code>rack.run_once</code></td><td>Boolean</td><td>Whether this process will handle only one request</td></tr>
<tr><td><code>rack.hijack?</code></td><td>Boolean</td><td>Whether the server supports connection hijacking</td></tr>
</tbody></table>
</div>
<p>In practice, you'll mostly use <code>REQUEST_METHOD</code>, <code>PATH_INFO</code>, <code>QUERY_STRING</code>, and <code>HTTP_*</code> headers. The <code>rack.input</code> stream is important for POST bodies.</p>
<p>Some real-world additions that aren't in the base spec but you'll encounter:</p>
<ul>
<li><code>rack.session</code> — your session data (added by session middleware)</li>
<li><code>rack.logger</code> — a logger (added by logger middleware)</li>
<li><code>action_dispatch.*</code> — Rails-specific additions</li>
<li><code>HTTP_COOKIE</code> — cookies as a string (<code>"name=value; other=thing"</code>)</li>
</ul>
<h2 id="the-response-array"><a class="header" href="#the-response-array">The Response Array</a></h2>
<p>The response is <code>[status, headers, body]</code>:</p>
<p><strong>Status</strong>: An integer HTTP status code. <code>200</code>, <code>201</code>, <code>301</code>, <code>404</code>, <code>500</code>. That's it.</p>
<pre><code class="language-ruby">status = 200
</code></pre>
<p><strong>Headers</strong>: A Hash of response headers. Keys are strings. Values are strings.</p>
<pre><code class="language-ruby">headers = {
  'Content-Type'  =&gt; 'text/html; charset=utf-8',
  'Content-Length' =&gt; '13',
}
</code></pre>
<p><strong>Body</strong>: An object that responds to <code>each</code>, yielding string chunks. Usually an Array of strings, sometimes an IO object for streaming.</p>
<pre><code class="language-ruby">body = ["Hello, World!"]

# Or for streaming:
body = SomeObject.new
def body.each
  yield "chunk 1"
  yield "chunk 2"
  yield "chunk 3"
end
</code></pre>
<p>The full minimal response:</p>
<pre><code class="language-ruby">[200, {'Content-Type' =&gt; 'text/plain'}, ['Hello, World!']]
</code></pre>
<h2 id="the-simplest-possible-rack-app"><a class="header" href="#the-simplest-possible-rack-app">The Simplest Possible Rack App</a></h2>
<pre><code class="language-ruby"># hello.rb
require 'rack'

app = lambda do |env|
  [200, {'Content-Type' =&gt; 'text/plain'}, ['Hello, World!']]
end

Rack::Handler::WEBrick.run app, Port: 9292
</code></pre>
<p>Run it:</p>
<pre><code class="language-bash">$ gem install rack
$ ruby hello.rb
[2026-02-19 12:00:00] INFO  WEBrick 1.7.0
[2026-02-19 12:00:00] INFO  ruby 3.3.0
[2026-02-19 12:00:00] INFO  WEBrick::HTTPServer#start: pid=12345 port=9292
</code></pre>
<p>Then:</p>
<pre><code class="language-bash">$ curl http://localhost:9292
Hello, World!
</code></pre>
<p>The lambda is a Rack application. It takes <code>env</code>, returns <code>[status, headers, body]</code>. The spec is satisfied.</p>
<h2 id="the-configru-format"><a class="header" href="#the-configru-format">The config.ru Format</a></h2>
<p>Most Ruby web servers look for a <code>config.ru</code> file in the current directory. It's processed by <code>Rack::Builder</code>, which gives you a small DSL:</p>
<pre><code class="language-ruby"># config.ru

require_relative 'app'

use MyMiddleware           # add middleware to the stack
use AnotherMiddleware, option: 'value'

run MyApplication.new      # the innermost app
</code></pre>
<ul>
<li><code>use</code> adds a middleware layer</li>
<li><code>run</code> sets the inner application</li>
<li><code>map</code> mounts apps at different paths (more on this later)</li>
</ul>
<p>You can run any <code>config.ru</code> with:</p>
<pre><code class="language-bash">$ rackup            # uses config.ru in current directory
$ rackup myapp.ru   # uses a specific file
</code></pre>
<p><code>rackup</code> figures out the best available server and starts it.</p>
<h2 id="reading-the-environment"><a class="header" href="#reading-the-environment">Reading the Environment</a></h2>
<p>Here's a Rack app that echoes back what it received:</p>
<pre><code class="language-ruby"># echo.ru
require 'json'

app = lambda do |env|
  # Collect interesting parts of the env
  info = {
    method:       env['REQUEST_METHOD'],
    path:         env['PATH_INFO'],
    query_string: env['QUERY_STRING'],
    headers:      env.select { |k, _| k.start_with?('HTTP_') },
  }

  # Read the body if there is one
  body = env['rack.input'].read
  info[:body] = body unless body.empty?

  response_body = JSON.pretty_generate(info)

  [
    200,
    {
      'Content-Type'   =&gt; 'application/json',
      'Content-Length' =&gt; response_body.bytesize.to_s,
    },
    [response_body]
  ]
end

run app
</code></pre>
<pre><code class="language-bash">$ rackup echo.ru &amp;
$ curl -X POST http://localhost:9292/test?foo=bar \
  -H 'Content-Type: application/json' \
  -d '{"hello": "world"}'
</code></pre>
<pre><code class="language-json">{
  "method": "POST",
  "path": "/test",
  "query_string": "foo=bar",
  "headers": {
    "HTTP_HOST": "localhost:9292",
    "HTTP_USER_AGENT": "curl/7.88.1",
    "HTTP_ACCEPT": "*/*",
    "HTTP_CONTENT_TYPE": "application/json",
    "HTTP_CONTENT_LENGTH": "18"
  },
  "body": "{\"hello\": \"world\"}"
}
</code></pre>
<p>Notice that <code>Content-Type</code> in the request becomes <code>HTTP_CONTENT_TYPE</code> in the env. The transformation is: <code>HTTP_</code> prefix + uppercase + hyphens become underscores. The <code>Host</code> header becomes <code>HTTP_HOST</code>. <code>User-Agent</code> becomes <code>HTTP_USER_AGENT</code>.</p>
<p>There are two exceptions: <code>Content-Type</code> is available as both <code>HTTP_CONTENT_TYPE</code> and <code>CONTENT_TYPE</code> (without the <code>HTTP_</code> prefix), and <code>Content-Length</code> is <code>CONTENT_LENGTH</code>. This is for historical compatibility.</p>
<h2 id="validation-does-your-app-comply"><a class="header" href="#validation-does-your-app-comply">Validation: Does Your App Comply?</a></h2>
<p><code>Rack::Lint</code> is a middleware that validates Rack compliance. Wrap your app with it during development:</p>
<pre><code class="language-ruby"># config.ru (development)
require 'rack'

app = lambda do |env|
  [200, {'Content-Type' =&gt; 'text/plain'}, ['Hello']]
end

# Lint will raise on any spec violation
use Rack::Lint if ENV['RACK_ENV'] == 'development'
run app
</code></pre>
<p><code>Rack::Lint</code> will raise an exception if:</p>
<ul>
<li>Your app doesn't return a three-element array</li>
<li>The status isn't an integer</li>
<li>Headers aren't a hash of strings</li>
<li>The body doesn't respond to <code>each</code></li>
<li>The body elements aren't strings</li>
<li>The env is missing required keys</li>
</ul>
<p>It's useful when writing new middleware or apps. You won't see many Rack violations in production code because frameworks handle this — but when writing bare Rack code, <code>Rack::Lint</code> is your first line of defense.</p>
<h2 id="the-spec-is-deliberately-minimal"><a class="header" href="#the-spec-is-deliberately-minimal">The Spec Is Deliberately Minimal</a></h2>
<p>The Rack spec doesn't say anything about:</p>
<ul>
<li>How to parse query strings</li>
<li>How to parse cookies</li>
<li>How to handle sessions</li>
<li>How to do routing</li>
<li>How to render templates</li>
<li>How to parse JSON or form bodies</li>
</ul>
<p>These are all optional. You can build them yourself, use Rack's helpers, or use a framework. The spec only defines the handshake between server and application, not what the application does with the request.</p>
<p>This minimalism is intentional and correct. It means any Ruby object that can accept a hash and return a three-element array is a web application. It means a Rails app and a Sinatra app and a Roda app and a hand-rolled lambda all speak the same language at the boundary between server and application.</p>
<p>The result is an ecosystem where you can mix and match: Rails routes can mount Sinatra apps, Sinatra apps can mount Rack apps, everything can be wrapped in arbitrary middleware, and the server doesn't care what you're running as long as you respond to <code>call</code>.</p>
<h2 id="the-napkin-version"><a class="header" href="#the-napkin-version">The Napkin Version</a></h2>
<p>If you had to write the Rack spec on a napkin, it would say:</p>
<pre><code>call(env) -&gt; [status, headers, body]

env:    Hash of CGI-style variables + rack.* keys
status: Integer HTTP status code
headers: Hash of {String =&gt; String}
body:   Responds to each, yields strings
</code></pre>
<p>Everything else — sessions, routing, templates, auth — is above this abstraction. The abstraction itself is simple enough to hold in your head, which means you can reason about it clearly when things go wrong.</p>
<p>Next: let's use it.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../what-frameworks-do.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../rack/first-app.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../what-frameworks-do.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../rack/first-app.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
